/**
 * 控制器基类
 * @authors yutent (yutent@doui.cc)
 * @date    2016-01-02 23:19:16
 *
 */

"use strict";

let Tpls = require('dojs-template')

class Controller {

    constructor(ctrl){
        this.view = new Tpls
        this.base = ctrl
        this.tpl = APPS + this.base + '/views/'
    }

    //定义一个变量，类似于smarty，把该
    assign(key, val){
        key += ''
        if(!key || empty(val))
            return

        this.view.assign(key, val)
    }

    //模板渲染, 参数是模板名, 可不带后缀, 默认是 .tpl
    rander(file){
        this.view.rander(this.tpl + file, html => {
            Response.rander(html)
        }).catch(err => {
            Response.error(err)
        })
    }

    //解决js回调恶梦
    async(fn){
        if(typeof fn !== 'function')
            return Response.error('action not found', 404)
        
        return libs.CO.call(this, fn)
    }
}


module.exports = Controller